# 
# Mounts the previously uploaded videos from the NFS server and processes input video
#   - outputs to the /mnt/output/ folder, until all output files exist.
#   - k8s Job which runs to completion.  Random file process order as multiple workers.
#

apiVersion: batch/v1
kind: Job
metadata:
  name: lane-detect
spec:
  replicas: 1
  selector:
    matchLabels:
      name: lane-detect
  template:
    metadata:
      labels:
        name: lane-detect
    spec:
      containers:
      - image: guydavis/lane-detect
        workingDir: /mnt
        command:
          - /usr/bin/python3
          - /opt/lane_detect.py
        args:
          - images/*
        imagePullPolicy: IfNotPresent
        name: lane-detect
        volumeMounts:
          - name: my-pvc-nfs
            mountPath: "/mnt"
      restartPolicy: Never
      volumes:
      - name: my-pvc-nfs
        persistentVolumeClaim:
          claimName: nfs